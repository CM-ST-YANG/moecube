<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Candy - Chats are not dead yet</title>
    <link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="node_modules/candy/libs.min.css"/>
    <link rel="stylesheet" type="text/css" href="node_modules/candy/res/default.css"/>
    <style>
        body {
            font-family: -apple-system, Arial, 'Source Sans Pro', "Microsoft YaHei", 'Microsoft JhengHei', "WenQuanYi Micro Hei", sans-serif;
        }
        /* Turn on custom 8px wide scrollbar */
        ::-webkit-scrollbar {
            width: 8px; /* 1px wider than Lion. */
            /* This is more usable for users trying to click it. */
            background-color: rgba(0,0,0,0);
            -webkit-border-radius: 100px;
        }
        /* hover effect for both scrollbar area, and scrollbar 'thumb' */
        ::-webkit-scrollbar:active {
            background-color: rgba(0, 0, 0, 0.05);
        }

        /* The scrollbar 'thumb' ...that marque oval shape in a scrollbar */
        ::-webkit-scrollbar-thumb:vertical {
            /* This is the EXACT color of Mac OS scrollbars.
               Yes, I pulled out digital color meter */
            background: rgba(0,0,0,0.1);
            -webkit-border-radius: 100px;
        }
        ::-webkit-scrollbar-thumb:vertical:active {
            background: rgba(0,0,0,0.2); /* Some darker color when you click it */
            -webkit-border-radius: 100px;
        }

        .scroll {
            overflow-y: hidden;
        }

        .scroll:hover {
            overflow-y: auto;

        }
    </style>

    <script>delete module.exports</script>
    <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="node_modules/candy/libs.min.js"></script>
    <script type="text/javascript" src="node_modules/candy/candy.min.js"></script>


    <!-- plugins -->
    <!--<script type="text/javascript" src="node_modules/candy-shop/replies/candy.js"></script>-->
    <!--<link rel="stylesheet" type="text/css" href="node_modules/candy-shop/replies/candy.css"/>-->

    <script type="text/javascript" src="node_modules/candy-shop/notifyme/candy.js"></script>
    <link rel="stylesheet" type="text/css" href="node_modules/candy-shop/notifyme/candy.css"/>

    <script type="text/javascript" src="node_modules/candy-shop/namecomplete/candy.js"></script>
    <link rel="stylesheet" type="text/css" href="node_modules/candy-shop/namecomplete/candy.css"/>

    <script type="text/javascript" src="node_modules/candy-shop/modify-role/candy.js"></script>
    <link rel="stylesheet" type="text/css" href="node_modules/candy-shop/modify-role/candy.css"/>

    <!-- 内联图片插件不好用 -->
    <!--<script type="text/javascript" src="node_modules/candy-shop/inline-images/candy.js"></script>-->
    <!--<link rel="stylesheet" type="text/css" href="node_modules/candy-shop/inline-images/candy.css"/>-->

    <script type="text/javascript" src="node_modules/candy-shop/me-does/candy.js"></script>

    <script type="text/javascript" src="node_modules/candy-shop/notifications/candy.js"></script>

    <script type="text/javascript" src="node_modules/candy-shop/refocus/candy.js"></script>

    <!--<script type="text/javascript" src="node_modules/candy-shop/slash-commands/slash-commands.js"></script>-->


    <!--正在输入那个插件不好用-->
    <!--<script type="text/javascript" src="node_modules/candy-shop/typingnotifications/typingnotifications.js"></script>-->
    <!--<link rel="stylesheet" type="text/css" href="node_modules/candy-shop/typingnotifications/typingnotifications.css" />-->
    <style>
        .message-pane-wrapper, .message-form-wrapper {
            margin-right: 190px;
        }
        .roster-pane, #chat-toolbar{
            width: 190px
        }
    </style>
    <style>
        #candy {
            background-color: #f7f7f9;
        }
        #chat-tabs li {
            box-shadow: 0 0 1px 1px #ccc;
        }
        #chat-tabs a {
            color: #999;
            background-color: #ececec;
        }
        #chat-tabs .active a.label {
            background-color: white;
        }
        #chat-tabs .active .transition, #chat-tabs .transition {
            background: none;
            /*background-color: white;*/
        }
        .message-pane-wrapper{
            background-color: white;
            padding: 0;
        }
        .message-pane li {
            border-bottom: none;
            box-shadow: none;
            padding: 0 5px;
        }
        .message-pane li>div {
            padding: 0 0 0 150px;
            line-height: 28px;
        }
        .message-pane .label {
            margin-left: -150px;
            width: 130px;
        }
        .roster-pane {
            background-color: initial;
            border-top: none;
            box-shadow: none;
            margin: 30px 0 32px 0;
        }
        .roster-pane .user {
            border-bottom: none;
            box-shadow: none;
            color: black;
        }
        .roster-pane .user:hover {
            background-color: #ebf3f8;
        }
        #chat-toolbar {
            background-color: initial;
            border-top: 1px solid #eee;
            box-shadow: none;
        }
        .message-form-wrapper {
            border-top: 1px solid #eee;
        }
        .roster-pane .label{
            text-shadow: none
        }
        #candy {
            border-top: 1px solid #eee;
            box-shadow: inset 0 1px 2px white;
        }

        .usercount span {
            background-color: initial;
            color: #a7a7a7;
        }

        /*#chat-toolbar #emoticons-icon, #chat-toolbar .usercount {*/
            /*background-image: initial;*/
        /*}*/

        /*#chat-toolbar #emoticons-icon::before, #chat-toolbar .usercount::before {*/
            /*font-size: 16px;*/
        /*}*/

</style>
</head>
<body>
<div id="candy"></div>
<script type="text/javascript">
    const {remote, ipcRenderer} = require('electron');
    //    remote.getCurrentWebContents().openDevTools();
    require('electron-cookies'); // https://github.com/hstove/electron-cookies

    ipcRenderer.on('join', (event, message) => {
        if (Candy.View.Pane.Chat.rooms[message]) {
            Candy.View.Pane.Room.show(message);
        } else {
            Candy.Core.Action.Jabber.Room.Join(message);
        }
    });

    // fix
    Base64.encode = (data) => new Buffer(data).toString('base64');
    Base64.decode = (data) => new Buffer(data, 'base64').toString();

    // candy init
    const params = new URLSearchParams(location.search);

    Candy.View.Template.Login.form = '<form method="post" id="login-form" class="login-form">' + '<input type="hidden" id="nickname" name="nickname" value="' + params.get('nickname') + '"/>' + '{{#displayUsername}}<input type="hidden" id="username" name="username" value="' + params.get('jid') + '"/>' + '{{#displayDomain}} <span class="at-symbol">@</span> ' + '<select id="domain" name="domain">{{#domains}}<option value="{{domain}}">{{domain}}</option>{{/domains}}</select>' + "{{/displayDomain}}" + "{{/displayUsername}}" + '{{#presetJid}}<input type="hidden" id="username" name="username" value="{{presetJid}}"/>{{/presetJid}}' + '{{#displayPassword}}<input type="hidden" id="password" name="password" value="' + params.get('password') + '"/>{{/displayPassword}}' + '<input type="submit" class="button" value="{{_loginSubmit}}" /></form>';
//    Candy.View.Template.Chat.toolbar = '<ul id="chat-toolbar">' + '<li id="emoticons-icon" class="fa fa-smile-o" data-tooltip="{{tooltipEmoticons}}"></li>' + '<li id="chat-sound-control" class="checked" data-tooltip="{{tooltipSound}}"></li>' + '<li class="checked" id="chat-statusmessage-control" data-tooltip="{{tooltipStatusmessage}}">' + '</li><li class="context" data-tooltip="{{tooltipAdministration}}"></li>' + '<li class="usercount fa fa-user-o" data-tooltip="{{tooltipUsercount}}">' + '<span id="chat-usercount"></span></li></ul>',

    Candy.Util.setCookie('candy-nostatusmessages', '1', 365);
    Candy.init('wss://chat.mycard.moe:5280/websocket', {
        core: {
            debug: false,
            autojoin: params.get('autojoin') && [params.get('autojoin')],
            resource: 'mycard-' + Math.random().toString().split('.')[1],
            enableXHTML: true
        },
        view: {assets: 'node_modules/candy/res/', language: params.get('language')}
    });

    CandyShop.NotifyMe.init();
    CandyShop.NameComplete.init();
    CandyShop.ModifyRole.init();
    CandyShop.MeDoes.init();
    CandyShop.Notifications.init();
    CandyShop.Refocus.init();

    Candy.Core.connect(params.get('jid'), params.get('password'), params.get('nickname'));

</script>

</body>
</html>
